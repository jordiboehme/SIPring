{% extends "base.html" %}

{% block title %}{{ config.name }} - SIPring{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div>
            <h1>{{ config.name }}</h1>
            {% if is_ringing %}
            <span class="status-badge status-ringing">Ringing ({{ ring_state }})</span>
            {% elif config.enabled %}
            <span class="status-badge status-enabled">Enabled</span>
            {% else %}
            <span class="status-badge status-disabled">Disabled</span>
            {% endif %}
        </div>
        <div>
            <button class="btn btn-primary" onclick="triggerRing('{{ ring_url }}', this)">
                Ring Now
            </button>
            {% if is_ringing %}
            <button class="btn btn-secondary" onclick="triggerRing('{{ cancel_url }}', this)">
                Cancel
            </button>
            {% endif %}
        </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
        <div>
            <label style="color: var(--text-secondary); font-size: 12px;">SIP Target</label>
            <div>{{ config.sip_user }}@{{ config.sip_server }}:{{ config.sip_port }}</div>
        </div>
        <div>
            <label style="color: var(--text-secondary); font-size: 12px;">Caller ID</label>
            <div>{{ config.caller_name }} ({{ config.caller_user }})</div>
        </div>
        <div>
            <label style="color: var(--text-secondary); font-size: 12px;">Ring Duration</label>
            <div>{{ config.ring_duration }} seconds</div>
        </div>
        <div>
            <label style="color: var(--text-secondary); font-size: 12px;">Local Port</label>
            <div>{{ config.local_port }}</div>
        </div>
    </div>

    <div class="form-group">
        <label>Ring URL</label>
        <div class="url-box">
            <code>{{ ring_url }}</code>
            <button onclick="copyToClipboard('{{ ring_url }}', this)">Copy</button>
        </div>
    </div>

    <div class="form-group">
        <label>Cancel URL</label>
        <div class="url-box">
            <code>{{ cancel_url }}</code>
            <button onclick="copyToClipboard('{{ cancel_url }}', this)">Copy</button>
        </div>
    </div>

    {% if config.last_ring_at %}
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
        <h3 style="margin-bottom: 10px; color: var(--text-secondary);">Last Ring</h3>
        <div>{{ config.last_ring_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</div>
        {% if config.last_ring_status %}
        <div>Status: {{ config.last_ring_status }}</div>
        {% endif %}
    </div>
    {% endif %}

    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
        <label style="color: var(--text-secondary); font-size: 12px;">Configuration ID</label>
        <div style="font-family: monospace; font-size: 14px;">{{ config.id }}</div>
        {% if config.slug %}
        <label style="color: var(--text-secondary); font-size: 12px; margin-top: 10px; display: block;">Slug</label>
        <div>{{ config.slug }}</div>
        {% endif %}
        <label style="color: var(--text-secondary); font-size: 12px; margin-top: 10px; display: block;">Created</label>
        <div>{{ config.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</div>
    </div>

    <div style="margin-top: 30px; display: flex; gap: 10px;">
        <button class="btn btn-success" onclick="testRing('{{ config.id }}', this)">Test (3s)</button>
        <a href="/config/{{ config.slug or config.id }}/edit" class="btn btn-secondary">Edit</a>
        <button class="btn btn-secondary" style="color: var(--accent);"
                onclick="deleteConfig('{{ config.id }}', '{{ config.name }}')">Delete</button>
        <a href="/" class="btn btn-secondary">Back</a>
    </div>
</div>
{% endblock %}
